<% provide :title, "Lession" %>
<h3 class='text-center cate-name'><%= @category.name %> <span><strong>1</strong>
  /20</span></h3>
<div class='row' id='show_result'>
  <div class='col-md-8 col-md-offset-2'>
    <div id='notice' class='well'>Congratulation! You've finished the lession. Click 
      below to see the result!</div>
    <div class='questions'>
      <%= form_tag @category, method: :get, remote: true do %>
        <% @words.each_with_index do |word, i| %>
          <div class='question' id='question<%= i + 1 %>'>
            <div class='row'>
              <div class='col-md-6'>
                <h3><%= word.content %></h3>
              </div>
              <div class='col-md-6'>
                <ul class='answers list-unstyled clearfix' id='answer-lession'>
                  <% word.answers.order('RANDOM()').each do |answer| %>
                    <li class='answer' data-correct="<%= answer.status %>">
                      <%= radio_button("result", "#{word.id}", answer.id) %> 
                      <%= answer.content %>
                    </li>
                  <% end %>
                </ul>
              </div>
              <button type='button' data='<%= i + 2 %>' id='btn-next-<%= i + 1 %>' class='
                btn btn-primary btn-next'>Next</button>
            </div>
          </div>
        <% end %>        
        <%= submit_tag 'Submit', class: 'btn btn-primary' %>
      <% end %>
    </div>
  </div>
</div>

<script type='text/javascript'>
  var num_correct = 0;
  var v = parseInt($('h3 span strong').text());
  $('.btn-next').addClass('disabled');
  $('#notice').hide();
  $('.question').hide();
  $('.questions input.btn').hide();
  $('.question').first().show();
  $('li.answer input').click(function(){
    $(this).parent().children().removeClass("checked");
    $(this).addClass("checked");
    $('.btn-next').removeClass('disabled');
  });
    
  $('.btn-next').click(function() {
    v = v + 1;
    arg = $(this).attr('data');
    $('h3 span strong').text(v);
    $('.question').hide();
    $('#question'+arg).show();
    $('.btn-next').addClass('disabled');
  });

  $('#btn-next-20').click(function() {
    $('.questions input.btn').show();
    $('h3 span').hide();
    $('#notice').show();
    num_correct = $('input.checked').parent('li[data-correct="true"]').length;
  });
</script>